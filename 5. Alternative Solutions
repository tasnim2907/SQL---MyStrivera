-- Q4: Show each employee's salary and the average salary of their department.
select *, AVG(salary) over (partition by department) as avg_dept_salary from employees;

-- Q5: List employees who earn more than the average salary in their department.
-- WINDOW + CTE
with CTE as
(select first_name, last_name, department, salary,
AVG(salary) over (partition by department) as avg_dept_salary from employees)
select * from CTE where salary > avg_dept_salary;

-- Q7: Show names of employees who work in departments that belong to the 'Electronics' division.
-- JOIN
select e.first_name, e.last_name from employees e
left join departments d on e.department = d.department
where division = 'Electronics';

-- Q10: Find departments where the average salary is higher than the average salary across all employees.
with CTE as
(select 
department,
avg (salary) over (partition by department) as dept_avg_salary,
avg (salary) over () as overall_avg_salary
from employees)

select distinct department, dept_avg_salary from CTE
where dept_avg_salary > overall_avg_salary
order by dept_avg_salary desc;

-- Q12: List employees whose salary is the highest within their department (no JOIN).
with CTE as
(select *, 
rank () over (partition by department order by salary) as RNK
from employees)
select * from CTE
where RNK = 1;

-- Q13: Find regions with at least one employee earning above 150000.
select distinct r.region from regions r
left join employees e on r.region_id = e.region_id
where salary > 150000;
